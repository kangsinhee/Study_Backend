## Protocol Buffer

> Protocol Buffer(protobuf): 직렬화(Serialization) 데이터 구조 형식

#### 직렬화란?

컴퓨터가 데이터를 파일에 쓰든, 네트워크에 사용하든 결국 모든 것은 0, 1인 bit로 표현함  

UTF-8 문자열 인코딩을 예로 들면 "hello" 라는 문자 데이터를 다른 서버에 보내게 된다면, 
각 문자에 대해 16진수 인코딩을 진행하게 되고, 68(h), 65(e), 6C(l), 6C(l), 6F(o)로 
변환되어 전달되는 과정이 문자열 직렬화임

이 외에도 객체 직렬화라는 것도 존재하며, 
이들을 모두 통틀어 바이트 스트림으로 만드는것을 직렬화라고 함

---

#### 원리

```json
{ 
    "userName":"Martin", 
    "favouriteNumber":1337, 
    "interests":["daydreaming","hacking"] 
}
```

예를 들어 Person Class를 만들고 그 객체를 JSON 포맷으로 만든다고 하면 위와 같이 만든 후,
데이터 크기를 보면 공백을 빼도 총 82 Byte를 사용하게 됨

```protobuf
message Person {
	required string user_name = 1; 
	optional int64 favourite_number = 2; 
	repeated string interests = 3;
}
```

  ![img](https://blog.kakaocdn.net/dn/uBybi/btqvUQTpgj4/2s6CXS1V92CSsMnnisMLgk/img.png)

여기서 똑같은 Person 객체를 Protocol buffer 포맷으로 만든 것이 위 코드 이며,
위 그림은 어떻게 직렬화가 진행되는지 원리에 대한 설명임. 

이 그림에서 주목해야 할 점은 userName와 같은 불필요한 속성 값을 숫자로 대체해 버린 점이 핵심임.
데이터 첫 바이트는 메타 정보로 첫 5bit는 tag,  두 번째 3bit는 타입을 표현하며, 
다음 두 번째 바이트 부터는 뒤로 이어질 데이터의 길이를 알려줌

이러한 원리로 데이터를 표현하게 되면 JSON과 같은 내용의 데이터라도 더 적은 33 바이트로 표현할 수 있음 

---

#### 장 단점

장점

* 통신이 빠름
  * 위에서 알아 봤듯이 같은 데이터를 보내더라도 비교적 작은 데이터로 표현되어 
    같은 시간 내, 더 많은 데이터를 보낼 수 있음
  * 크기와는 다른 의미로 더 빠르기도 함

* 파싱을 할 필요가 없음
  * 정해진 Schema 대로 직렬화, 역직렬화 하면됨(빠름), 타입이 안맞아 오류날 가능성이 적음
    -> 내부 서비스에서 사용하기 좋음

* 다양한 언어를 지원함
  * C++, C#, 자바, 파이썬, Go, 루비, 자바 스크립트를 위한 코드 생성기를 제공함

단점

* 인간이 읽기 불편함
  * JSON같은 포멧은 사람이 읽기 편함, 반대로 프로토콜 버퍼가 쓴 데이터는 사람이 읽기 어려움
    proto 파일이 없다면 무슨 의미인지 알기 어려움, 이 때문에 외부 API로 사용하기 문제가 있음

* proto 문법을 알아야 함
  * 프로토콜 버퍼에서 사용하는 proto 파일을 작성할 줄 알아야 함
    크게 어렵지 않지만, 정확하게 작성하기 위해선 문법을 알아야 함. 
  * proto 파일 속성이 업데이트 되면 해당 스키마 파일을 사용하는 모든 어플리케이션 모두를 수정해야 함