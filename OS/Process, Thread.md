## Process, Thread

> 운영체제, 프로그램 작동 방식의 기본

#### Process와 Thread의 정의

**프로세스**(Process)

* 운영체제로부터 자원을 할당받는 **자원**의 단위

* 메모리에 올라와 실행되고 있는 프로그램의 인스턴스
* 동적개념으로 실행된 프로그램을 의미

**스레드**(Thread)

* 프로세스가 할당받은 자원을 이용하는 **실행 흐름**의 단위

### 프로그램 → 프로세스 → 스레드

#### 프로그램 → 프로세스

##### **프로그램**의 정의

파일이 저장장치에 있지만 메모리에는 올라가 있지 않은 **정적 상태**

모든 프로그램은 실행되기 위해서는 운영체제가 실행을 위한 메모리 공간을 할당해줘야 함 
이때 파일은 운영체제가 프로그램에서 독립적인 메모리 공간을 확보해 주지 않았다는 뜻

> 실행되기 되지 않은 파일 그자체를 가리키는 말

##### 프로세스?

프로그램을 실행하게 된다면, 해당 파일은 메모리 공간에 올라가게 됨

> 이때 **동적 상태**라고 하며 해당 프로그램을 **프로세스**라고 함 

##### 특징

* 프로세스는 할당된 메모리 외 정보에는 접근할 수 없음
* 각각 독립된 메모리영역과 주소 공간을 운영체제로부터 할당 받음

##### 메모리 구조

| Process | Des                                                          |
| ------- | ------------------------------------------------------------ |
| Code    | 프로그램 명령이 위치하는 곳으로 기계어로 제어되는 영역       |
| Data    | 전역변수나 Static 변수의 할당을 위해 존재하는 공간           |
| Stack   | 지역변수 할당과 함수 호출 시 전달되는 인자 값들을 저장하기 위한 공간 |
| Heap    | 동적할당을 위해 존재하는 공간                                |



#### 프로세스 → 스레드

##### 스레드는 또 뭐고

*쓰레드는 프로세스의 한계를 해결하기 위해 만들어짐*

점점 프로그램은 복잡해지고 프로세스 하나만을 사용해서 실행하기 벅차게 됨
이때 운영체제는 안전성을 위해 한 프로그램에서 여러 프로세스를 만들어 사용하지 못함

> 이때 각 프로세스에선 **더 작은 실행 단위**가 필요했고 
> 이를 **쓰레드**라고 함

* 스레드는 스레드 간 메모리를 공유하며 작동함
  * 스레드는 한 프로세스의 Code, Data, Heap 영역을 공유함
  * 만약 스레드 하나에서 오류가 발생한다면 다른 프로세스들 또한 강제 종료
* 운영체제 관점에선 프로세스가 최소 작업 단위
* CPU 관점에선 쓰레드가 최소 작업 단위

> 스레드는 프로세스의 코드에 정의된 절차에 따라 실행되는 특정한 수행 경로



### 멀티 스레드, 멀티 프로세스

#### 멀티 스레드

* 하나의 프로세스가 다수 개의 작업을 각각 스레드를 이용하여 동시에 작동시킴
* 스레드는 부모 프로세스의 각 Code, Data, Heap 영역에서 공유메모리를 가짐



#### 멀티 프로세스

* 부모-자식 관계라고 해도 자신만의 메모리 영역을 가지게 됨
* 환경변수와 프로세스 핸들 테이블이 상속 가능할 뿐 결국 독립적인 관계임
* fork를 통해 프로세스를 복사함
* 유닉스 계열에서 ps 명령어로 현재 수행되고 있는 프로세스를 확인할 수 있음
* 프로세스 간의 통신을 하려면 IPC(Inter Process Communication; 세마포어, 큐, 공유메모리)를 통해야 함

*멀티 스레드는 멀티 프로세스에 비해 상당한 이점을 가짐*

1. 컨텍스트 스위칭 시, 공유 메모리 만큼의 시간(자원) 손실이 줄어듬

   프로세스 간의 컨텍스트 스위칭시 단순히 CPU 레지스터 교체 뿐만이 아니라 RAM과 CPU사이의 캐쉬메모리에 대한 데이터 까지 초기화 되므로 상당한 부담이 발생함

2. Stack을 제외한 모든 메모리를 공유하기 때문에 전역, 정적, 변수 그리고 new malloc에 의한 모든 자료를 공유할 수 있음



### 동시성과 병렬성

동시성과 병렬성은 멀티 스레드의 동작 방식임

**동시성**

* 싱글 코어에서 멀티 스레드를 동작시키기 위한 방식
* 여러개의 스레드가 번갈아가면서 실행되는 성질

*동시성을 아용한 멀티태스킹은 각 스레드가 병렬적으로 실행되는 것처럼 보이지만*
*번갈아 가며 조금식 실행 되는 것임*

**병렬성**

* 멀티 코어에서 멀티 스레드를 동작시키는 방식
* 한개 이상의 스레드를 포함하는 각 코어들이 동시에 실행되는 성질
* 병렬성은 **데이터 병렬성**과, **작업 병렬성**으로 구분됨



**데이터 병렬성**

* 전체 데이터를 쪼개 서브 데이터로 만든 뒤, 서브 데이터들을 
  병렬 처리하여 작업을 빠르게 수행하는 것을 말함

* Java 8부터 지원하는 병렬 스트림이 데이터 병렬성을 구현한 것

* 서브 데이터는 멀티 코어으이 수만큼 쪼개어 각각의 
  데이터들을 분리된 스레드에서 병렬처리 함

**작업 병렬성**

* 서로 다른 작업을 병렬 처리하는 것

*대표적인 예는 웹 서버로 각각의 브라우저에서 요청한 내용을 개별 스레드에서 병렬로 처리함*



### Reference