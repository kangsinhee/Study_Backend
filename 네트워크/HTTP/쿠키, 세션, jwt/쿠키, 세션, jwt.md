### 쿠키, 세션, jwt(json web token)

----

### HTTP 프로토콜의 특징

1. Connectionless
   클라이언트와 서버가 요청과 응답을 한번 주고 받으면 연결을 끊어버리는 특징을 가지고 있음. 
   클라이언트가 request를 한번 서버로 보내면 서버는 클라이언트가 보낸 request에 맞게 response를 보내고 바로 연결을 끊는다.
2. Stateless
   요청과 응답으로 인해 통신이 끝난다면 상태정보를 유지하지 않는 특징이 있음
   예를 들면 메인페이지에서 로그인을 한뒤 다른 페이지로 넘어가면 다시 로그인을 해야함

-> **그래서 써야됨 ㅇㄱㄹㅇ**



#### 인증방식

#### 쿠키

1. **쿠키**
   쿠키는 클라이언트에 저장되는 key와 value로 이루어진 데이터임
   인증 유효시간을 설정할수 있으며, 이때문에 클라이언트가 종료되어도 쿠키가 유지된다.
   서버와 요청 응답으로 인해 쿠키가 저장되면 다음 요청은 쿠키에 담긴 정보를 참조한다.
2. **동작 방식**
   1. 클라이언트가 로그인 요청
   2. 서버에서 쿠키를 생성후 클라이언트로 전달
   3. 클라이언트가 서버로 요청을 보낼 때 쿠키를 전송
   4. 쿠키를 이용해 지속적으로 유저 인증을 진행함

#### 세션

1. **세션**
   쿠키는 서버에서 생성해 클라이언트가 저장하지만, 세션은 서버에 저장해 관리함
   서버에서는 각 클라이언트를 구별하기 위해 각각의 세션ID를 부여하며 클라이언트가 종료하기 전까지 유지함 
   클라이언트가 저장하는 쿠키보다 세션이 보안이 더 좋다.

2. **세션동작방식**

   1. 클라이언트가 로그인 요청
      1. 서버에서 클라이언트에게 고유ID 부여후 세션 저장소에 저장한 후 클라이언트에게 발급함
      2. 클라이언트는 서버에서 발급 받은 세션 ID를 쿠키에 저장하고 요청을 보낼때 마다 쿠키를 보냄
      3. 서버는 쿠키에 담긴 세션ID와 세션 저장소에 대조후 데이터를 가져옴

    하이재킹 공격을 통해 공격이 가능하나 세션의 유효시간을 만들어 예방가능

    세션 저장소를 서버에서 관리하기 때문에 사용자가 많아질수록 부하가 커짐

#### JWT

 1. **JWT **
    JWT는 Json Web Token의 약자로 인증에 필요한 정보들을 암호화한 토큰을 말함

    세션 방식처럼 토큰 자체를 쿠키에 담아서 보내 줄수도 있고, http 헤더에 담는 방법도 있음

    <img src="https://velopert.com/wp-content/uploads/2016/12/jwt.png" alt="jwt" style="zoom: 50%;" />

    JWT는 세가지 요소로 구성되어 있음

    * **Header** : 3가지 요소를 암호화할 해시알고리즘 등과 같은 옵션이 들어간다.
    * **Payload** : 유저의 고유 ID 등 인증에 필요한 정보가 들어간다.
    * **Signature** : Hearder, payload와 Secret Key가 더해져 암호화 됨

    헤더와 페이로드는 누구나 디코딩해 내용을 확인 할수 있기때문에 유저의 비밀번호 같은 정보는 넣지 않도록 한다.

    하지만 Secret Key를 알지 못하면 Signature는 디코딩 할 수 없음

2. **토큰 동작방식**

   1. 클라이언트가 로그인 요청
   2. 서버에서 유저의 고유한 ID와 다은 인증 정보들과 함께 Payload에 담음
   3. JWT의 유효기간 설정 및 암호화할 알고리즘을 설정함
   4. Secret Key를 이용해 토큰을 발급함
   5. 발급된 토큰은 클라이언트에 쿠키나 로컬스토리지 등에 저장하여 요청을 보낼때 마다 같이 보냄
   6. 서버는 토큰을 Secret Key로 복호화해 검증하는 과정을 거침
   7. 검증이 완료되면 대응하는 데이터를 보내준다.

   토큰은 일단 세션보다 간편함

   세션처럼 별도의 저장소 관리가 필요하지 않고 토큰을 발급 후 클라이언트에게 전송 후 검증하는 과정만 있으면 됨

   그러나 발급된 JWT 삭제가 불거눙

   세션은 악의적으로 사용된다면 해당 세션을 삭제하면 그만이지만, 토큰은 유효시간이 종료되기 전까지 얼마든지 악의적으로 사용 가능

   -> Refresh 토큰으로 피해를 줄일 수 있음

   ![img](C:\Users\kangsinhee\Desktop\programming\Study_Backend\쿠키, 세션, jwt\1.png)

   #### JWT Token Claim 항목

   * `iss`: 토큰을 발급한 발급자(Issuer)

   - `sub`: Claim의 주제(Subject)로 토큰이 갖는 문맥을 의미한다.
   - `aud`: 이 토큰을 사용할 수신자(Audience)
   - `exp`: 만료시간(Expiration Time)은 만료시간이 지난 토큰은 거절해야 한다.
   - `nbf`: Not Before의 의미로 이 시간 이전에는 토큰을 처리하지 않아야 함을 의미한다.
   - `iat`: 토큰이 발급된 시간(Issued At)
   - `jti`: JWT ID로 토큰에 대한 식별자이다.
